import smbus2
import bme280
import mh_z19
import time
import mysql.connector
import threading

mydb = mysql.connector.connect(
  host="127.0.0.1",
  user="root",
  passwd="password",
  database='product',
    port = "3306"
)

mycursor = mydb.cursor()
port = 1
address = 0x76
bus = smbus2.SMBus(port)

calibration_params = bme280.load_calibration_params(bus, address)

data = bme280.sample(bus, address, calibration_params)
def sensor_data_collecting():
    while True:
        try:
            temp = sensor.temperature
            humidity = sensor.humidity
            co2 = mh_z19.read()#https://github.com/UedaTakeyuki/mh-z19/blob/master/mh_z19.py
            print("Temperature: {}*C   Humidity: {}%    CO2: {}ppm "
                    .format(data.temperature, data.humidity, co2['co2']))
            #https://pypi.org/project/mh-z19/
            sql = "INSERT INTO sensors_data (temperature, humidity, co2) VALUES (%s, %s, %s)"
            val = (str(data.temperature), str(data.humidity), str(co2['co2']))
            mycursor.execute(sql, val)
        except RuntimeError as error:
            print(error.args[0])
            time.sleep(10.0)
            continue
        except Exception as error:
            sensor.exit()
            raise error
        time.sleep(10.0)

thread = threading.Thread(target=sensor_data_collecting, )
thread.start()

#mycursor.execute("SELECT temperature, humidity, co2 FROM sensors_data where id = (select max(id) from sensors_data)")
#myresult = mycursor.fetchall()